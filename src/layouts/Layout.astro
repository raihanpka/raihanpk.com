---
import Footer from '@/components/Footer.astro'
import Head from '@/components/Head.astro'
import Header from '@/components/Header.astro'
import FloatingChatButton from '@/components/chat/FloatingChatButton.tsx'
import { SITE } from '@/consts'

type Props = {
  title: string
  description: string
  image?: string
}

const { title, description, image } = Astro.props
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <link 
      rel="preload" 
      href="https://cloud.umami.is/script.js" 
      as="script"
      fetchpriority="low"
    >
    <Head
      title={`${title} | ${SITE.TITLE}`}
      description={description}
      image={image}
    />
  </head>
  <body class="min-h-screen bg-background text-foreground antialiased">
    <div class="flex min-h-screen flex-col">
      <Header />
      <main class="flex-1">
        <div class="container mx-auto px-4 py-8">
          <slot />
        </div>
      </main>
      {Astro.url.pathname === '/' && <FloatingChatButton client:load />}
      <Footer />
    </div>
    
    <!-- Load analytics after main content is interactive -->
    <script is:inline>
      if ('requestIdleCallback' in window) {
        window.requestIdleCallback(loadAnalytics, { timeout: 2000 });
      } else {
        window.addEventListener('load', loadAnalytics);
      }
      
      function loadAnalytics() {
        const script = document.createElement('script');
        script.src = 'https://cloud.umami.is/script.js';
        script.setAttribute('data-website-id', 'd5f41f5f-8925-4e9a-91a1-b7226a775f8a');
        script.async = true;
        document.body.appendChild(script);
      }
    </script>
  </body>
</html>
